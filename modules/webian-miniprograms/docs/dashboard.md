# 无边映社模块
版本：20240301
## 目录结构
```
webian-pay 模块目录
├─wxpay           微信支付
│  ├─controller      控制器目录
│  └─event.php          事件定义文件
│
├─douyin                抖音支付
│  ├─app.php            应用配置
│  └─view.php           视图配置
│
├─alipay            支付宝
├─route                 路由定义目录
│  ├─route.php          路由定义文件
│  └─ ...
│
├─public                WEB目录（对外访问目录）
│  ├─index.php          入口文件
│  └─.htaccess          用于apache的重写
│
├─autoload.php                 模块加载
├─setting.php                 设置页面
```
## 项目需求
 - 用户充值独立于每个小程序
 - 代理商通过小程序进行加盟申请，要求：姓名/身份证/手机号/代理协议
 - 判断用户看完剧集，弹出点评窗口：剧情内容/角色演技/服化道具/画面特效/制作质量，总体评分（1-5星）
 - 记录用户观看内容，并记录观看时长
 - 提醒用户添加追剧更新通知

## 会员体系
### 付费价格
#### 单集付费
199点
#### 充值比例
充值金额 x 100
#### 充值档次
| 充值金额 | 获得点数 | 赠送 | 备注               |
| -------- | -------- | ---- | ------------------ |
| 1.99元   | 199      | 0    | 看本集，首次0.99元 |
| 9.9元    | 990      | 500  | 首充双倍           |
| 29.9元   | 2990     | 1000 | 首充双倍           |
| 69.9元   | 6990     | 3000 | 首充双倍           |
| 99.9元   | 9990     | 5000 | 首充双倍           |
| 128元    | —        | —    | 年卡会员全站免费看 |

## 代理政策
### 代理权益
| 项目           | 青铜   | 白银   | 黄金  | 钻石     |
| -------------- | ------ | ------ | ----- | -------- |
| 价格           | 99元   | 599元  | 999元 | 1299元   |
| 提现周期       | T+7    | T+5    | T+3   | T+1      |
| 提现条件       | 2000元 | 1000元 | 500元 | 任意金额 |
| 服务费率       | 40%    | 30%    | 20%   | 10%      |
| 主题模板       | ❌      | ❌      | ✔️     | ✔️        |
| 个性海报       | ❌      | ❌      | ✔️     | ✔️        |
| 活动促销       | ❌      | ❌      | ✔️     | ✔️        |
| 小程序申请协助 | ❌      | ❌      | ✔️     | ✔️        |
| 去除版权       | ❌      | ❌      | ❌     | ✔️        |



## 小程序
### 助手
#### 预加载

### 客户端
#### 预加载
#### 追剧
##### 最近观看
##### 我的追剧
#### 剧场
#### 我的

## 后台管理
### 仪表盘
#### 充值金额
- 今日
- 本月
- 年度
#### 用户数量
- 新增
- 总数
#### 待办事项
- 提现申请

### 消费记录
### 充值记录

## 数据库表
### 会员表
| 字段          | 类型       | 说明               |
| ------------- | ---------- | ------------------ |
| member_id     | int(20)    | 自增ID             |
| user_id       | int(20)    | 关联用户ID         |
| source        | string(20) | 所属平台：wx/dy/tt |
| appid         | string(20) | 小程序AppId        |
| jifen         | int(20)    | 积分               |
| player_time   | int(20)    | 观看时长           |
| player_number | int(20)    | 观看短剧数量       |
| created_at    | timestamp  | 注册时间           |
### 积分消费表
| 字段        | 类型      | 说明       |
| ----------- | --------- | ---------- |
| ID          | int(20)   | 自增ID     |
| user_id     | int(20)   | 关联用户ID |
| post_id     | int(20)   | 剧集ID     |
| num_pay     | int(20)   | 消费积分   |
| num_surplus | int(20)   | 剩余积分   |
| created_at  | timestamp | 扣除时间   |
### 积分充值表
| 字段        | 类型       | 说明               |
| ----------- | ---------- | ------------------ |
| ID          | int(20)    | 自增ID             |
| user_id     | int(20)    | 关联用户ID         |
| member_name | string(20) | 会员别名           |
| source      | string(20) | 所属平台：wx/dy/tt |
| created_at  | timestamp  | 注册时间           |
| appid       | string(20) | 小程序AppId        |
| jifen       | int(20)    | 积分               |
| time_post   | timestamp  | 发布时间           |
### 提现记录表
### 剧集点评表
### 剧集点赞表
### 剧集收藏表
### 用户观看记录表
| 字段        | 类型      | 说明           |
| ----------- | --------- | -------------- |
| member_id   | int(20)   | 自增ID         |
| user_id     | int(20)   | 关联用户ID     |
| post_id     | int(20)   | 剧集ID         |
| play_number | int(20)   | 集数           |
| play_time   | int(20)   | 剧集时长（秒） |
| created_at  | timestamp | 观看时间       |
